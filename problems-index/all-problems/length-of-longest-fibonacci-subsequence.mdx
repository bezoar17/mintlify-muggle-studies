---
title: "ðŸ§€ Length of Longest Fibonacci Subsequence"
description: '[leetcode link](https://leetcode.com/problems/length-of-longest-fibonacci-subsequence/description/)'
mode: 'wide'
---
<Tabs>
  <Tab title="Question" icon="circle-question" iconType="regular">
    <Card>
      <p>A sequence <code>x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>n</sub></code> is <em>Fibonacci-like</em> if:</p>  <ul>  <li><code>n &gt;= 3</code></li>  <li><code>x<sub>i</sub> + x<sub>i+1</sub> == x<sub>i+2</sub></code> for all <code>i + 2 &lt;= n</code></li> </ul>  <p>Given a <b>strictly increasing</b> array <code>arr</code> of positive integers forming a sequence, return <em>the <strong>length</strong> of the longest Fibonacci-like subsequence of</em> <code>arr</code>. If one does not exist, return <code>0</code>.</p>  <p>A <strong>subsequence</strong> is derived from another sequence <code>arr</code> by deleting any number of elements (including none) from <code>arr</code>, without changing the order of the remaining elements. For example, <code>[3, 5, 8]</code> is a subsequence of <code>[3, 4, 5, 6, 7, 8]</code>.</p>   <p><strong class="example">Example 1:</strong></p>   <strong>Input:</strong> arr = [1,2,3,4,5,6,7,8] <br/> <strong>Output:</strong> 5 <br/> <strong>Explanation:</strong> The longest subsequence that is fibonacci-like: [1,2,3,5,8].  <p><strong class="example">Example 2:</strong></p>   <strong>Input:</strong> arr = [1,3,7,11,12,14,18] <br/> <strong>Output:</strong> 3 <strong>Explanation</strong>:<strong> </strong>The longest subsequence that is fibonacci-like: [1,11,12], [3,11,14] or [7,11,18].   <p><strong>Constraints:</strong></p>  <ul>  <li><code>3 &lt;= arr.length &lt;= 1000</code></li>  <li><code>1 &lt;= arr[i] &lt; arr[i + 1] &lt;= 10<sup>9</sup></code></li> </ul> 
    </Card>
  </Tab>
  <Tab title="Solution" icon="lightbulb" iconType="regular" >
    <Card>
      Need to store 2D in dp also, not only traversal of n^2, but state storage also needs to store the last 2 idxs.
For each num, we check all previous nums, such that the diff of num_i-num_j also exists in the array, if yes, numi, numj can be last 2 of fibonacci sequence. We store the max len of fibonacci with i and j as last 2 idxs.
</Card>
  <Expandable title="code">
    <CodeGroup dropdown>
```ruby title="Length of Longest Fibonacci Subsequence" lines
# @param {Integer[]} arr
# @return {Integer}
def len_longest_fib_subseq(arr)
  n = arr.size
  idx_hash = arr.each_with_index.to_h
  dp = Hash.new {|h,k| h[k] = {} }
  max_length = 0

  arr.each_with_index do |num, i|
    (0...i).each do |j|
      val_k = num - arr[j]
      next unless val_k < arr[j] && idx_hash.key?(val_k)

      k = idx_hash[val_k]
      dp[j][i] = dp[k][j] ? dp[k][j] + 1 : 3
      max_length = [max_length, dp[j][i]].max
    end
  end
  
  max_length
end
```
    </CodeGroup>
  </Expandable>
  </Tab>
</Tabs>