---
title: 'ðŸ§€ Count Unreachable Pairs of Nodes in an Undirected Graph'
description: '[leetcode link](https://leetcode.com/problems/count-unreachable-pairs-of-nodes-in-an-undirected-graph/description/)'
mode: 'wide'
---
<Tabs>
  <Tab title="Question" icon="circle-question" iconType="regular">
    <Card>
      <p>You are given an integer <code>n</code>. There is an <strong>undirected</strong> graph with <code>n</code> nodes, numbered from <code>0</code> to <code>n - 1</code>. You are given a 2D integer array <code>edges</code> where <code>edges[i] = [a<sub>i</sub>, b<sub>i</sub>]</code> denotes that there exists an <strong>undirected</strong> edge connecting nodes <code>a<sub>i</sub></code> and <code>b<sub>i</sub></code>.</p>  <p>Return <em>the <strong>number of pairs</strong> of different nodes that are <strong>unreachable</strong> from each other</em>.</p>   <p><strong class="example">Example 1:</strong></p> <img alt="" src="https://assets.leetcode.com/uploads/2022/05/05/tc-3.png" style="width: 267px; height: 169px;" />  <strong>Input:</strong> n = 3, edges = [[0,1],[0,2],[1,2]] <br/> <strong>Output:</strong> 0 <br/> <strong>Explanation:</strong> There are no pairs of nodes that are unreachable from each other. Therefore, we return 0.   <p><strong class="example">Example 2:</strong></p> <img alt="" src="https://assets.leetcode.com/uploads/2022/05/05/tc-2.png" style="width: 295px; height: 269px;" />  <strong>Input:</strong> n = 7, edges = [[0,2],[0,5],[2,4],[1,6],[5,4]] <br/> <strong>Output:</strong> 14 <br/> <strong>Explanation:</strong> There are 14 pairs of nodes that are unreachable from each other: [[0,1],[0,3],[0,6],[1,2],[1,3],[1,4],[1,5],[2,3],[2,6],[3,4],[3,5],[3,6],[4,6],[5,6]]. Therefore, we return 14.    <p><strong>Constraints:</strong></p>  <ul>  <li><code>1 &lt;= n &lt;= 10<sup>5</sup></code></li>  <li><code>0 &lt;= edges.length &lt;= 2 * 10<sup>5</sup></code></li>  <li><code>edges[i].length == 2</code></li>  <li><code>0 &lt;= a<sub>i</sub>, b<sub>i</sub> &lt; n</code></li>  <li><code>a<sub>i</sub> != b<sub>i</sub></code></li>  <li>There are no repeated edges.</li> </ul> 
    </Card>
  </Tab>
  <Tab title="Solution" icon="lightbulb" iconType="regular" >
    <Card>
      UnionFind is clear. Find different components which are unreachable to each other. Now instead of finding pairs of components and calculating unreachable nodes between these components( this will be n^2 where n is no. of components). We can subtract reachable node pairs from total pairs for each component, this is n, where n is no. of components.
    </Card>
  <Expandable title="code">
    <CodeGroup dropdown>
```ruby title="Count Unreachable Pairs of Nodes in an Undirected Graph" lines
# @param {Integer} n
# @param {Integer[][]} edges
# @return {Integer}
class UnionFind
  attr_accessor :nodes, :sizes
  attr_reader :max_set_size

  def initialize(node_keys=[])
    @nodes = {}
    @sizes = {}
    @max_set_size = 0
    node_keys.each { |i| root(i) }
  end

  # this will create a node key if it doesnt exist
  def root(i)
    nodes[i] ||= i; sizes[i] ||= 1; # create node if it doesnt exist

    while nodes[i] != i
      nodes[i] = nodes[nodes[i]] # path compression
      i = nodes[i]
    end
    i
  end

  def size_for(i)
    sizes[root(i)]
  end

  def union(i, j)
    root_of_i = root(i)
    root_of_j = root(j)

    return false if root_of_i == root_of_j

    if sizes[root_of_j] > sizes[root_of_i]
      nodes[root_of_i] = root_of_j
      sizes[root_of_j] += sizes[root_of_i]
    else
      nodes[root_of_j] = root_of_i
      sizes[root_of_i] += sizes[root_of_j]
    end
    @max_set_size = [@max_set_size, sizes[root_of_i], sizes[root_of_j]].max
  end
end

def count_pairs(n, edges)
  uf = UnionFind.new((0...n).to_a)
  edges.each {|u,v| uf.union(u,v)}
  roots = uf.nodes.select {|i| i==uf.nodes[i]}.map(&:first)

  size = roots.size;
  total_pairs = n*(n-1)/2;

  roots.each do |root|
    component_size = uf.sizes[root]
    total_pairs-= (component_size*(component_size-1)/2)
  end
  total_pairs
end
```
    </CodeGroup>
  </Expandable>
  </Tab>
</Tabs>