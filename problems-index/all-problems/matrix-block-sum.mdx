---
title: 'ðŸ§€ Matrix Block Sum'
description: '[leetcode link](https://leetcode.com/problems/matrix-block-sum/description/)'
mode: 'wide'
---
<Tabs>
  <Tab title="Question" icon="circle-question" iconType="regular">
    <Card>
      <p>Given a <code>m x n</code> matrix <code>mat</code> and an integer <code>k</code>, return <em>a matrix</em> <code>answer</code> <em>where each</em> <code>answer[i][j]</code> <em>is the sum of all elements</em> <code>mat[r][c]</code> <em>for</em>:</p>  <ul>  <li><code>i - k &lt;= r &lt;= i + k,</code></li>  <li><code>j - k &lt;= c &lt;= j + k</code>, and</li>  <li><code>(r, c)</code> is a valid position in the matrix.</li> </ul>   <p><strong class="example">Example 1:</strong></p>   <strong>Input:</strong> mat = [[1,2,3],[4,5,6],[7,8,9]], k = 1 <br/> <strong>Output:</strong> [[12,21,16],[27,45,33],[24,39,28]]   <p><strong class="example">Example 2:</strong></p>   <strong>Input:</strong> mat = [[1,2,3],[4,5,6],[7,8,9]], k = 2 <br/> <strong>Output:</strong> [[45,45,45],[45,45,45],[45,45,45]]    <p><strong>Constraints:</strong></p>  <ul>  <li><code>m ==&nbsp;mat.length</code></li>  <li><code>n ==&nbsp;mat[i].length</code></li>  <li><code>1 &lt;= m, n, k &lt;= 100</code></li>  <li><code>1 &lt;= mat[i][j] &lt;= 100</code></li> </ul> 
    </Card>
  </Tab>
  <Tab title="Solution" icon="lightbulb" iconType="regular" >
    <Card>
      No notes for this problem
    </Card>
  <Expandable title="code">
    <CodeGroup dropdown>
```ruby title="Matrix Block Sum" lines
# @param {Integer[][]} mat
# @param {Integer} k
# @return {Integer[][]}
def matrix_block_sum(mat, k)
  m, n = mat.length, mat[0].length
  
  # Compute 2D prefix sum matrix
  prefix_sum = Array.new(m + 1) { Array.new(n + 1, 0) }
  (0...m).each do |i|
    (0...n).each do |j|
      prefix_sum[i+1][j+1] = mat[i][j] + 
                              prefix_sum[i+1][j] + 
                              prefix_sum[i][j+1] - 
                              prefix_sum[i][j]
    end
  end
  
  # Compute result matrix
  answer = Array.new(m) { Array.new(n, 0) }
  (0...m).each do |i|
    (0...n).each do |j|
      r1 = [0, i - k].max
      r2 = [m - 1, i + k].min
      c1 = [0, j - k].max
      c2 = [n - 1, j + k].min
      
      answer[i][j] = prefix_sum[r2+1][c2+1] - 
                     prefix_sum[r2+1][c1] - 
                     prefix_sum[r1][c2+1] + 
                     prefix_sum[r1][c1]
    end
  end
  
  answer
end
```
    </CodeGroup>
  </Expandable>
  </Tab>
</Tabs>