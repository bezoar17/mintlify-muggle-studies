---
title: 'ðŸ§€ Best Time to Buy and Sell Stock II'
description: '[leetcode link](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii/description/)'
mode: 'wide'
---
<Tabs>
  <Tab title="Question" icon="circle-question" iconType="regular">
    <Card>
      <p>You are given an integer array <code>prices</code> where <code>prices[i]</code> is the price of a given stock on the <code>i<sup>th</sup></code> day.</p>  <p>On each day, you may decide to buy and/or sell the stock. You can only hold <strong>at most one</strong> share of the stock at any time. However, you can buy it then immediately sell it on the <strong>same day</strong>.</p>  <p>Find and return <em>the <strong>maximum</strong> profit you can achieve</em>.</p>   <p><strong class="example">Example 1:</strong></p>   <strong>Input:</strong> prices = [7,1,5,3,6,4] <br/> <strong>Output:</strong> 7 <br/> <strong>Explanation:</strong> Buy on day 2 (price = 1) and sell on day 3 (price = 5), profit = 5-1 = 4. Then buy on day 4 (price = 3) and sell on day 5 (price = 6), profit = 6-3 = 3. Total profit is 4 + 3 = 7.   <p><strong class="example">Example 2:</strong></p>   <strong>Input:</strong> prices = [1,2,3,4,5] <br/> <strong>Output:</strong> 4 <br/> <strong>Explanation:</strong> Buy on day 1 (price = 1) and sell on day 5 (price = 5), profit = 5-1 = 4. Total profit is 4.   <p><strong class="example">Example 3:</strong></p>   <strong>Input:</strong> prices = [7,6,4,3,1] <br/> <strong>Output:</strong> 0 <br/> <strong>Explanation:</strong> There is no way to make a positive profit, so we never buy the stock to achieve the maximum profit of 0.    <p><strong>Constraints:</strong></p>  <ul>  <li><code>1 &lt;= prices.length &lt;= 3 * 10<sup>4</sup></code></li>  <li><code>0 &lt;= prices[i] &lt;= 10<sup>4</sup></code></li> </ul> 
    </Card>
  </Tab>
  <Tab title="Solution" icon="lightbulb" iconType="regular" >
    <Card>
      Keep 2 states, stock was 0, or stock was 1, given this, calculate current sum recursively using last index's value. In the end max profit is just the max sum you have. The recurence relation is 
    stock_0 = max ( last_stock_0,  last_stock_1 + prices[i] ) case 1 -&gt; didnt do anything, case 2 -&gt; sold last stock 1 and got money
		stock_1 = max ( last_stock_1,  last_stock_1 + prices[i] ) case 1 -&gt; didnt do anything, case 2 -&gt; bought last stock 0 and spent money
    </Card>
  <Expandable title="code">
    <CodeGroup dropdown>
```ruby title="Best Time to Buy and Sell Stock II" lines
# @param {Integer[]} prices
# @return {Integer}
# def max_profit(prices)
#   n = prices.size
#   last_stock_0 = 0
#   last_stock_1 = -prices[0]
  
#   n.times do |i|
#     stock_0 = [last_stock_0, last_stock_1 + prices[i]].max
#     stock_1 = [last_stock_1, last_stock_0 - prices[i]].max
#     last_stock_0, last_stock_1 = stock_0, stock_1
#   end
#   [last_stock_0, last_stock_1].max

#   return 0 if prices.size < 2
#     prices[1..-1].inject([0, -prices.first]) {|(s_0, s_1), p|
#         [[s_1 + p, s_0].max, [s_1, s_0 -p].max]
#     }.max
# end

def max_profit(prices)
   (prices[1..-1] + [0]).zip(prices).map{ |a,b| a-b }.select(&:positive?).sum
end
```
    </CodeGroup>
  </Expandable>
  </Tab>
</Tabs>