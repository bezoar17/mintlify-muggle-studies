---
title: "ðŸ§€ Count Submatrices With All Ones"
description: '[leetcode link](https://leetcode.com/problems/count-submatrices-with-all-ones/description/)'
mode: 'wide'
---
<Tabs>
  <Tab title="Question" icon="circle-question" iconType="regular">
    <Card>
      <p>Given an <code>m x n</code> binary matrix <code>mat</code>, <em>return the number of <strong>submatrices</strong> that have all ones</em>.</p>   <p><strong class="example">Example 1:</strong></p> <img alt="" src="https://assets.leetcode.com/uploads/2021/10/27/ones1-grid.jpg" style="width: 244px; height: 245px;" />  <strong>Input:</strong> mat = [[1,0,1],[1,1,0],[1,1,0]] <br/> <strong>Output:</strong> 13 <br/> <strong>Explanation:</strong>  There are 6 rectangles of side 1x1. There are 2 rectangles of side 1x2. There are 3 rectangles of side 2x1. There is 1 rectangle of side 2x2.  There is 1 rectangle of side 3x1. Total number of rectangles = 6 + 2 + 3 + 1 + 1 = 13.   <p><strong class="example">Example 2:</strong></p> <img alt="" src="https://assets.leetcode.com/uploads/2021/10/27/ones2-grid.jpg" style="width: 324px; height: 245px;" />  <strong>Input:</strong> mat = [[0,1,1,0],[0,1,1,1],[1,1,1,0]] <br/> <strong>Output:</strong> 24 <br/> <strong>Explanation:</strong>  There are 8 rectangles of side 1x1. There are 5 rectangles of side 1x2. There are 2 rectangles of side 1x3.  There are 4 rectangles of side 2x1. There are 2 rectangles of side 2x2.  There are 2 rectangles of side 3x1.  There is 1 rectangle of side 3x2.  Total number of rectangles = 8 + 5 + 2 + 4 + 2 + 2 + 1 = 24.    <p><strong>Constraints:</strong></p>  <ul>  <li><code>1 &lt;= m, n &lt;= 150</code></li>  <li><code>mat[i][j]</code> is either <code>0</code> or <code>1</code>.</li> </ul> 
    </Card>
  </Tab>
  <Tab title="Solution" icon="lightbulb" iconType="regular" >
    <Card>
      Try to calculate for each row, going left to right, considering each cell to be the bottom right corner of the rectangle. While going left to right in a row, if we have heights of consecutive 1s, think like a histogram, for each cell, consider that it is part of. Consider 2 sets of height values
[2, 3, 1] and [1,3,2]. And calculating for the last cell, we have -&gt; 1+1+1 and 1+2+2. Based on min value of cell being calculated etc. This value is start from idx, and go to left, keep the current minimum from idx to left, upto the point it reaches 0, then we dont go left from there.
</Card>
  <Expandable title="code">
    <CodeGroup dropdown>
```ruby title="Count Submatrices With All Ones" lines
# @param {Integer[][]} mat
# @return {Integer}
def num_submat(mat)
  m = mat.size; n = mat[0].size;
  result = 0
  heights = Array.new(n, 0)

  (0...m).each do |i|
    heights = heights.map.with_index {|last_h, j| mat[i][j]==0 ? 0 : (last_h+1) }
    
    (0...n).each do |j|
      curr_min = heights[j]
      j.downto(0).each do |k|
        curr_min = [curr_min, heights[k]].min
        break if curr_min == 0
        result += curr_min
      end
    end
  end

  result
end
```
    </CodeGroup>
  </Expandable>
  </Tab>
</Tabs>